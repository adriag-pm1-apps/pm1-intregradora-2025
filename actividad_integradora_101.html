<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Actividad integradora PM1 - Progresi√≥n 3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --primary: #0d47a1;
            --primary-light: #1976d2;
            --primary-dark: #002171;
            --accent: #ffb300;
            --accent-soft: #fff3cd;
            --bg: #f5f5f5;
            --card-bg: #ffffff;
            --text-main: #212121;
            --text-muted: #616161;
            --border-soft: #e0e0e0;
            --error: #c62828;
            --success: #2e7d32;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: radial-gradient(circle at top, #e3f2fd 0, #f5f5f5 55%, #e8eaf6 100%);
            color: var(--text-main);
        }

        .app-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px 16px 40px;
        }

        header {
            text-align: center;
            margin-bottom: 16px;
        }

        header h1 {
            font-size: 1.7rem;
            margin: 0 0 4px;
            color: var(--primary-dark);
        }

        header h2 {
            font-size: 1.2rem;
            margin: 0;
            color: var(--primary);
            font-weight: 600;
        }

        header p {
            margin: 6px 0 0;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .layout {
            display: grid;
            grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
            gap: 18px;
            margin-top: 18px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 14px;
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.10);
            padding: 18px 18px 20px;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .card-title h3 {
            margin: 0;
            font-size: 1.08rem;
            color: var(--primary-dark);
        }

        .badge {
            font-size: 0.8rem;
            padding: 4px 9px;
            border-radius: 999px;
            background: #e3f2fd;
            color: var(--primary-dark);
            font-weight: 600;
        }

        .info-section {
            margin-bottom: 12px;
        }

        .info-section h4 {
            margin: 0 0 6px;
            font-size: 0.98rem;
            color: var(--primary);
        }

        .info-section p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .info-field label {
            display: block;
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 3px;
        }

        .info-field input,
        .info-field textarea {
            width: 100%;
            padding: 7px 9px;
            border-radius: 8px;
            border: 1px solid var(--border-soft);
            font-size: 0.9rem;
            font-family: inherit;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }

        .info-field textarea {
            resize: vertical;
            min-height: 48px;
        }

        .info-field input:focus,
        .info-field textarea:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 1px rgba(25, 118, 210, 0.22);
            background: #ffffff;
        }

        .readonly-field {
            background-color: #f3f3f3;
            cursor: default;
        }

        .integrantes-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
            margin-top: 8px;
        }

        .integrante-label {
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 3px;
        }

        .integrante-input {
            width: 100%;
            padding: 7px 9px;
            border-radius: 8px;
            border: 1px solid var(--border-soft);
            font-size: 0.9rem;
            font-family: inherit;
        }

        .integrante-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 1px rgba(25, 118, 210, 0.22);
        }

        .instructions-list {
            margin: 0;
            padding-left: 18px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .instructions-list li {
            margin-bottom: 4px;
        }

        .instructions-highlight {
            background: var(--accent-soft);
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 0.9rem;
            margin-top: 8px;
            border-left: 4px solid var(--accent);
        }

        .instructions-highlight strong {
            color: #8c6d1f;
        }

        .exercise-counter {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
        }

        .exercise-counter span {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .exercise-counter .current {
            font-weight: 600;
            color: var(--primary-dark);
        }

        .exercise-card {
            border-radius: 10px;
            padding: 10px 12px;
            background: #fdfdfd;
            border: 1px solid var(--border-soft);
            margin-bottom: 10px;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .exercise-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-main);
        }

        .exercise-tag {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 999px;
            background: #e8eaf6;
            color: #283593;
            font-weight: 600;
        }

        .exercise-body {
            font-size: 0.92rem;
            color: var(--text-main);
            margin-bottom: 6px;
        }

        .exercise-body .expression {
            font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 4px;
        }

        .exercise-context {
            font-size: 0.88rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .answer-area label {
            display: block;
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 3px;
        }

        .answer-area input {
            width: 100%;
            padding: 7px 9px;
            border-radius: 8px;
            border: 1px solid var(--border-soft);
            font-size: 0.9rem;
            font-family: inherit;
        }

        .answer-area input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 1px rgba(25, 118, 210, 0.22);
        }

        .feedback {
            margin-top: 6px;
            font-size: 0.9rem;
            min-height: 1.2em;
        }

        .feedback.correct {
            color: var(--success);
        }

        .feedback.incorrect {
            color: var(--error);
        }

        .buttons-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        button {
            border: none;
            border-radius: 999px;
            padding: 8px 14px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.05s ease;
        }

        button.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: #ffffff;
            box-shadow: 0 4px 10px rgba(13, 71, 161, 0.35);
        }

        button.secondary {
            background: #ffffff;
            color: var(--primary-dark);
            border-radius: 999px;
            border: 1px solid rgba(13, 71, 161, 0.18);
        }

        button.info {
            background: #ffffff;
            color: var(--text-muted);
            border-radius: 999px;
            border: 1px dashed rgba(33, 33, 33, 0.3);
            font-weight: 500;
        }

        button.primary:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(13, 71, 161, 0.45);
        }

        button.secondary:hover,
        button.info:hover {
            background: #f5f5f5;
        }

        button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        button:disabled {
            opacity: 0.6;
            cursor: default;
            box-shadow: none;
        }

        .results-card {
            margin-top: 5px;
        }

        .results-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .results-header h3 {
            margin: 0;
            font-size: 1.02rem;
            color: var(--primary-dark);
        }

        .summary-highlight {
            font-size: 0.95rem;
            padding: 10px 12px;
            border-radius: 10px;
            background: #f9fbe7;
            border: 1px solid #dce775;
            margin-bottom: 10px;
        }

        .summary-highlight strong {
            color: #827717;
        }

        .score-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 6px;
        }

        .score-row span {
            font-size: 0.95rem;
        }

        .score {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .percent {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--success);
        }

        .attempt-warning {
            font-size: 0.88rem;
            color: var(--error);
            margin-top: 4px;
        }

        .report-container {
            margin-top: 12px;
            padding-top: 8px;
            border-top: 1px dashed rgba(0, 0, 0, 0.12);
        }

        .report-instructions {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .report-box {
            margin-top: 6px;
            border-radius: 12px;
            padding: 12px;
            background: #ffffff;
            border: 1px solid #d1c4e9;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .report-header-left h4 {
            margin: 0;
            font-size: 0.95rem;
            color: #4527a0;
        }

        .report-header-left p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .report-header-right {
            text-align: right;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .report-grid {
            display: grid;
            grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.4fr);
            gap: 10px;
            margin-top: 8px;
            font-size: 0.85rem;
        }

        .report-grid h5 {
            margin: 0 0 4px;
            font-size: 0.86rem;
            color: var(--primary-dark);
        }

        .report-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }

        .report-label {
            font-weight: 600;
            color: var(--text-muted);
        }

        .report-value {
            font-weight: 500;
        }

        .report-score-box {
            border-radius: 10px;
            padding: 8px 9px;
            background: #f3e5f5;
            border: 1px solid #ce93d8;
            margin-top: 4px;
        }

        .report-score-main {
            font-size: 1.05rem;
            font-weight: 700;
            color: #4a148c;
        }

        .report-score-detail {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .report-footer {
            margin-top: 6px;
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            gap: 8px;
            align-items: center;
        }

        .watermark {
            font-size: 0.78rem;
            color: rgba(0, 0, 0, 0.35);
        }

        .teacher-name {
            font-weight: 600;
            color: #4a148c;
        }

        .hidden {
            display: none !important;
        }

        .note {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .note strong {
            color: var(--primary-dark);
        }

        .small {
            font-size: 0.8rem;
        }

        .highlight {
            color: var(--primary-dark);
            font-weight: 600;
        }

        .warning {
            color: var(--error);
            font-weight: 600;
        }

        .accent {
            color: #ef6c00;
            font-weight: 600;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 3px 8px;
            border-radius: 999px;
            background: #e3f2fd;
            color: var(--primary-dark);
            font-size: 0.78rem;
        }

        .pill-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #1e88e5;
        }

        .footer-message {
            margin-top: 12px;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-align: center;
        }

        .footer-message strong {
            color: var(--primary-dark);
        }

        @media (max-width: 900px) {
            .layout {
                grid-template-columns: minmax(0, 1fr);
            }

            .card {
                padding: 16px 14px 18px;
            }

            .report-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        @media (max-width: 600px) {
            header h1 {
                font-size: 1.5rem;
            }

            header h2 {
                font-size: 1.05rem;
            }

            .layout {
                gap: 12px;
            }

            .integrantes-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        /* --- Acceso con contrase√±a por grupo --- */
        #password-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.78);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .password-modal {
            background: #ffffff;
            max-width: 420px;
            width: 90%;
            padding: 24px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 32px rgba(0, 0, 0, 0.45);
            text-align: center;
        }
        .password-modal h2 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        .password-modal p {
            margin-bottom: 10px;
        }
        .password-modal input[type="password"] {
            width: 100%;
            padding: 10px 12px;
            font-size: 1rem;
            border-radius: 6px;
            border: 1px solid #cccccc;
            margin-bottom: 12px;
        }
        .password-modal button {
            width: 100%;
            padding: 10px 12px;
            font-size: 1rem;
        }
        .password-error {
            color: #b00020;
            font-size: 0.9rem;
            min-height: 1.2em;
        }
    </style>
</head>
<body>
  <div id="password-overlay" aria-modal="true" role="dialog">
    <div class="password-modal">
      <h2>Actividad integradora 101</h2>
      <p>Introduce la contrase√±a que te dio tu docente para comenzar.</p>
      <input type="password" id="access-password" placeholder="Contrase√±a" autocomplete="off">
      <button id="access-button" type="button">Entrar</button>
      <p id="password-error" class="password-error" aria-live="polite"></p>
    </div>
  </div>

<div class="app-container">
    <header>
        <h1>Actividad integradora ‚Äì Progresi√≥n 3</h1>
        <h2>Aplicaci√≥n de razones, proporciones y porcentajes en contextos reales</h2>
        <p>Registren sus datos, contesten los ejercicios paso a paso y al final tomen captura de pantalla del reporte.</p>
    </header>

    <div class="layout">
        <!-- Columna izquierda: Datos y ejercicio -->
        <section class="card">
            <div class="card-title">
                <h3>Datos del equipo y ejercicio asignado</h3>
                <span class="badge">Grupo 101</span>
            </div>

            <div class="info-section">
                <h4>Datos del equipo</h4>
                <p>Completen la informaci√≥n y revisen que sus nombres est√©n bien escritos.</p>

                <div class="info-grid">
                    <div class="info-field">
                        <label for="equipo">Nombre del equipo:</label>
                        <input type="text" id="equipo" placeholder="Ej. Los racionales">
                    </div>
                    <div class="info-field">
                        <label for="grupo">Grupo:</label>
                        <input type="text" id="grupo" value="101" readonly maxlength="20" class="readonly-field" autocomplete="off">
                    </div>
                    <div class="info-field">
                        <label for="turno">Turno:</label>
                        <input type="text" id="turno" placeholder="Ej. Matutino / Vespertino">
                    </div>
                </div>

                <div class="integrantes-grid">
                    <div>
                        <div class="integrante-label">Integrante 1:</div>
                        <input type="text" class="integrante-input" id="integrante1" placeholder="Nombre completo">
                    </div>
                    <div>
                        <div class="integrante-label">Integrante 2:</div>
                        <input type="text" class="integrante-input" id="integrante2" placeholder="Nombre completo">
                    </div>
                    <div>
                        <div class="integrante-label">Integrante 3:</div>
                        <input type="text" class="integrante-input" id="integrante3" placeholder="Nombre completo (opcional)">
                    </div>
                    <div>
                        <div class="integrante-label">Integrante 4:</div>
                        <input type="text" class="integrante-input" id="integrante4" placeholder="Nombre completo (opcional)">
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h4>Ejercicio asignado</h4>
                <p>La aplicaci√≥n seleccionar√° autom√°ticamente un ejercicio integral de la Progresi√≥n 3.</p>
                <ul class="instructions-list">
                    <li>Lean con atenci√≥n la situaci√≥n y subrayen los datos importantes.</li>
                    <li>Resuelvan paso a paso en su cuaderno antes de escribir el resultado final.</li>
                    <li>Escriban en la app solo el resultado final, con unidades cuando sea necesario.</li>
                </ul>
                <div class="instructions-highlight">
                    <strong>Importante:</strong> Registren solo una respuesta por equipo. Cuando est√©n seguros, hagan clic en
                    <span class="highlight">"Guardar respuesta"</span>.
                </div>
            </div>

            <div class="exercise-counter">
                <span>Ejercicio integral asignado</span>
                <span class="pill"><span class="pill-dot"></span> Progresi√≥n 3</span>
            </div>

            <div id="exercise-card" class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title" id="exercise-title">Situaci√≥n contextualizada</div>
                    <span class="exercise-tag" id="exercise-tag">Razones y porcentajes</span>
                </div>
                <div class="exercise-body">
                    <div id="exercise-description">
                        <!-- Aqu√≠ se insertar√° el ejercicio -->
                    </div>
                    <div class="exercise-context" id="exercise-context">
                        <!-- Contexto o instrucci√≥n adicional -->
                    </div>
                </div>

                <div class="answer-area">
                    <label for="respuesta">Resultado final del equipo:</label>
                    <input type="text" id="respuesta" placeholder="Escriban aqu√≠ el resultado final">
                </div>
                <div class="feedback" id="feedback"></div>

                <div class="buttons-row">
                    <button class="secondary" id="btnNewExercise" type="button">
                        ‚Üª Cambiar ejercicio
                    </button>
                    <button class="primary" id="btnSaveAnswer" type="button">
                        ‚úî Guardar respuesta
                    </button>
                    <button class="info" id="btnShowExample" type="button">
                        ‚ùì Ver ejemplo de resoluci√≥n
                    </button>
                </div>
            </div>

            <div class="note">
                <strong>Sugerencia:</strong> Si se equivocan en la primera respuesta, pueden intentar de nuevo,
                pero la app registrar√° <span class="warning">el n√∫mero de intentos</span> y la respuesta final que
                qued√≥ guardada.
            </div>
        </section>

        <!-- Columna derecha: Resultados y reporte -->
        <section class="card results-card">
            <div class="results-header">
                <h3>Seguimiento de la actividad</h3>
                <span class="badge">Resumen del equipo</span>
            </div>

            <div class="summary-highlight">
                <p id="summary-text">
                    Cuando guarden la respuesta de su equipo, aqu√≠ aparecer√° un resumen con los intentos,
                    el resultado final y sugerencias para mejorar.
                </p>
            </div>

            <div class="score-row">
                <span>Resultado final registrado:</span>
                <span class="score" id="score-result">‚Äì</span>
            </div>
            <div class="score-row">
                <span>Intentos realizados:</span>
                <span class="score" id="attempts-count">0</span>
            </div>
            <div class="score-row">
                <span>Porcentaje de avance en la actividad:</span>
                <span class="percent" id="progress-percent">0%</span>
            </div>
            <div class="attempt-warning" id="attempt-warning"></div>

            <div class="report-container">
                <div class="report-instructions">
                    <strong>Al terminar:</strong> generen el reporte, revisen sus datos y tomen una
                    <span class="highlight">captura de pantalla completa</span> donde se vea:
                    nombre del equipo, integrantes, grupo, respuesta final e intentos.
                </div>

                <div class="report-box" id="report-box">
                    <div class="report-header">
                        <div class="report-header-left">
                            <h4>DATOS DEL EQUIPO ‚Äì ACTIVIDAD INTEGRADORA</h4>
                            <p>Progresi√≥n 3 ¬∑ Pensamiento Matem√°tico I</p>
                        </div>
                        <div class="report-header-right">
                            <div>Fecha: <span id="report-date">‚Äì</span></div>
                            <div>Hora: <span id="report-time">‚Äì</span></div>
                        </div>
                    </div>

                    <div class="report-grid">
                        <div>
                            <h5>Equipo y grupo</h5>
                            <div class="report-row">
                                <span class="report-label">Nombre del equipo:</span>
                                <span class="report-value" id="result-team">‚Äì</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Integrantes:</span>
                                <span class="report-value" id="result-members">‚Äì</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Grupo:</span>
                                <span class="report-value" id="result-group">‚Äì</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Turno:</span>
                                <span class="report-value" id="result-shift">‚Äì</span>
                            </div>
                        </div>

                        <div>
                            <h5>Resultado de la actividad</h5>
                            <div class="report-row">
                                <span class="report-label">Ejercicio asignado:</span>
                                <span class="report-value" id="result-exercise">‚Äì</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Resultado final registrado:</span>
                                <span class="report-value" id="result-answer">‚Äì</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Intentos realizados:</span>
                                <span class="report-value" id="result-attempts">0</span>
                            </div>

                            <div class="report-score-box">
                                <div class="report-score-main" id="result-summary-main">
                                    Actividad en proceso
                                </div>
                                <div class="report-score-detail" id="result-summary-detail">
                                    Generen el reporte cuando est√©n seguros de su respuesta final.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="report-footer">
                        <span class="watermark">
                            Grupo 101 ¬∑ Actividad integradora Progresi√≥n 3 ¬∑ Pensamiento Matem√°tico I
                        </span>
                        <span class="teacher-name">Docente: Mtra. Adriana Arroyo</span>
                    </div>
                </div>

                <div class="buttons-row" style="margin-top: 10px;">
                    <button class="primary" id="btnGenerateReport" type="button">
                        üßæ Generar / actualizar reporte
                    </button>
                    <button class="secondary" id="btnClearData" type="button">
                        üóë Limpiar datos
                    </button>
                </div>

                <div class="note small">
                    <strong>Captura de pantalla:</strong> aseg√∫rense de que en la imagen se vea
                    <span class="highlight">todo el recuadro del reporte</span>, incluyendo el grupo y la fecha.
                </div>
            </div>

            <div class="footer-message">
                <strong>Recuerden:</strong> esta actividad integradora forma parte de su evaluaci√≥n.
                Trabajen con calma, dialoguen en equipo y justifiquen sus procedimientos.
            </div>
        </section>
    </div>
</div>

<script>
    (function () {
        "use strict";

        // ---------------------------------------------------------------------
        // CONFIGURACI√ìN GENERAL
        // ---------------------------------------------------------------------

        const STORAGE_KEY = "pm1_integral_p3_v2";
        const MAX_ATTEMPTS = 3;
        const MAX_EXERCISES = 10;
        const GROUP_NAME = "101";
        const GROUP_PASSWORD = "M212-1-730";

        // DOM elements
        const equipoInput = document.getElementById("equipo");
        const grupoInput = document.getElementById("grupo");
        if (grupoInput) {
            grupoInput.value = GROUP_NAME;
            grupoInput.readOnly = true;
            grupoInput.classList.add("readonly-field");
        }
        const turnoInput = document.getElementById("turno");

        const integrante1Input = document.getElementById("integrante1");
        const integrante2Input = document.getElementById("integrante2");
        const integrante3Input = document.getElementById("integrante3");
        const integrante4Input = document.getElementById("integrante4");

        const exerciseTitleEl = document.getElementById("exercise-title");
        const exerciseTagEl = document.getElementById("exercise-tag");
        const exerciseDescriptionEl = document.getElementById("exercise-description");
        const exerciseContextEl = document.getElementById("exercise-context");
        const respuestaInput = document.getElementById("respuesta");
        const feedbackEl = document.getElementById("feedback");

        const summaryTextEl = document.getElementById("summary-text");
        const scoreResultEl = document.getElementById("score-result");
        const attemptsCountEl = document.getElementById("attempts-count");
        const progressPercentEl = document.getElementById("progress-percent");
        const attemptWarningEl = document.getElementById("attempt-warning");

        const reportDateEl = document.getElementById("report-date");
        const reportTimeEl = document.getElementById("report-time");
        const resultTeamEl = document.getElementById("result-team");
        const resultMembersEl = document.getElementById("result-members");
        const resultGroupEl = document.getElementById("result-group");
        const resultShiftEl = document.getElementById("result-shift");
        const resultExerciseEl = document.getElementById("result-exercise");
        const resultAnswerEl = document.getElementById("result-answer");
        const resultAttemptsEl = document.getElementById("result-attempts");
        const resultSummaryMainEl = document.getElementById("result-summary-main");
        const resultSummaryDetailEl = document.getElementById("result-summary-detail");

        const btnNewExercise = document.getElementById("btnNewExercise");
        const btnSaveAnswer = document.getElementById("btnSaveAnswer");
        const btnShowExample = document.getElementById("btnShowExample");
        const btnGenerateReport = document.getElementById("btnGenerateReport");
        const btnClearData = document.getElementById("btnClearData");

        // ---------------------------------------------------------------------
        // BANCO DE EJERCICIOS ‚Äì PROGRESI√ìN 3
        // ---------------------------------------------------------------------

        const exercises = [
            {
                id: "P3-INT-01",
                title: "Descuento y porcentaje de ahorro",
                tag: "Porcentajes y descuentos",
                description:
                    "En una tienda de deportes, un conjunto de pants y sudadera tiene un precio marcado de $1,250. Por el Buen Fin, la tienda ofrece un descuento del 35% sobre el precio marcado. Despu√©s del descuento, se debe pagar todav√≠a un 16% de IVA sobre el precio con descuento.",
                context:
                    "a) Calculen cu√°l es el monto del descuento en pesos. b) Determinen el precio final que pagar√° el cliente despu√©s de aplicar el descuento y el IVA. c) Expliquen qu√© porcentaje del precio original termin√≥ pagando el cliente."
            },
            {
                id: "P3-INT-02",
                title: "Mezcla de concentraciones",
                tag: "Razones y proporciones",
                description:
                    "Para preparar 10 litros de una soluci√≥n desinfectante, se recomienda mezclar una parte de concentrado por cada 9 partes de agua. Un conserje necesita preparar 25 litros de soluci√≥n utilizando la misma proporci√≥n.",
                context:
                    "a) ¬øCu√°ntos litros de concentrado y cu√°ntos de agua debe usar para obtener 25 litros de soluci√≥n? b) Expresen la relaci√≥n 'concentrado : agua' como una raz√≥n simplificada. c) Expliquen c√≥mo comprobar que su mezcla mantiene la misma concentraci√≥n que la recomendada."
            },
            {
                id: "P3-INT-03",
                title: "Aumento de sueldo escalonado",
                tag: "Porcentajes sucesivos",
                description:
                    "Una persona gana actualmente $8,500 mensuales. En enero recibe un aumento del 12% y, seis meses despu√©s, la empresa decide otorgar un aumento adicional del 5% sobre el nuevo sueldo.",
                context:
                    "a) Calculen el sueldo despu√©s del primer aumento. b) Determinen el sueldo final despu√©s del segundo aumento. c) Expliquen por qu√© no es correcto sumar simplemente 12% + 5% para obtener el aumento total."
            },
            {
                id: "P3-INT-04",
                title: "Comparaci√≥n de ofertas de internet",
                tag: "Razones y porcentajes",
                description:
                    "Dos compa√±√≠as de internet ofrecen los siguientes paquetes: ‚Ä¢ Compa√±√≠a A: 80 Mbps por $520 al mes. ‚Ä¢ Compa√±√≠a B: 120 Mbps por $750 al mes.",
                context:
                    "a) Calculen el costo por Mbps en cada compa√±√≠a. b) Determinen cu√°l oferta conviene m√°s en t√©rminos de costo por Mbps. c) Expliquen su decisi√≥n considerando tambi√©n otros factores posibles (no num√©ricos)."
            },
            {
                id: "P3-INT-05",
                title: "Plan de ahorro para un viaje",
                tag: "Porcentajes y promedios",
                description:
                    "Un equipo de estudiantes quiere ahorrar para un viaje que costar√° aproximadamente $18,000 en total. Planean ahorrar durante 9 meses. En los primeros 4 meses logran reunir en promedio $1,200 por mes.",
                context:
                    "a) Calculen cu√°nto dinero han reunido en esos 4 meses. b) Determinen cu√°nto les falta por ahorrar. c) Calculen cu√°nto deber√≠an ahorrar en promedio cada mes, durante los 5 meses restantes, para alcanzar la meta."
            },
            {
                id: "P3-INT-06",
                title: "Rebaja y devoluci√≥n",
                tag: "Porcentajes y proporcionalidad",
                description:
                    "En una tienda de electr√≥nica, una computadora tiene un precio de lista de $15,800. Primero se aplica una rebaja del 20%. Despu√©s de la compra, el cliente participa en una din√°mica y gana una tarjeta de regalo equivalente al 8% del precio que pag√≥.",
                context:
                    "a) Determinen cu√°nto paga finalmente por la computadora. b) Calculen el valor de la tarjeta de regalo. c) Expliquen qu√© porcentaje del precio original representa la tarjeta de regalo."
            },
            {
                id: "P3-INT-07",
                title: "Producci√≥n de botellas",
                tag: "Razones y proporciones",
                description:
                    "Una m√°quina embotelladora llena 2,400 botellas en 40 minutos trabajando a ritmo constante. La f√°brica planea instalar una segunda m√°quina id√©ntica para aumentar la producci√≥n.",
                context:
                    "a) ¬øCu√°ntas botellas llenar√° una sola m√°quina en 1 hora? b) Si trabajan las dos m√°quinas al mismo tiempo durante 1 hora con el mismo ritmo, ¬øcu√°ntas botellas llenar√°n en total? c) Expresen la relaci√≥n entre 'n√∫mero de m√°quinas' y 'producci√≥n total' como una raz√≥n o proporci√≥n."
            },
            {
                id: "P3-INT-08",
                title: "Encuesta escolar",
                tag: "Porcentajes y frecuencias",
                description:
                    "En una encuesta aplicada a 250 estudiantes sobre su medio de transporte para llegar a la escuela, se obtuvo: 32% utiliza cami√≥n urbano, 18% taxi, 25% autom√≥vil particular y el resto camina.",
                context:
                    "a) Calculen cu√°ntos estudiantes corresponden a cada medio de transporte. b) Determinen qu√© porcentaje representa el grupo que camina. c) Expliquen c√≥mo podr√≠an representar esta informaci√≥n en una gr√°fica de sectores."
            },
            {
                id: "P3-INT-09",
                title: "Conversi√≥n de divisas",
                tag: "Razones y proporcionalidad",
                description:
                    "En una casa de cambio se establece que 1 d√≥lar equivale a 18.90 pesos. Una persona desea cambiar $3,500 pesos a d√≥lares para una compra en l√≠nea.",
                context:
                    "a) ¬øCu√°ntos d√≥lares obtendr√° con $3,500 pesos? b) Si despu√©s encuentra una promoci√≥n donde el d√≥lar est√° a 18.30 pesos, ¬øcu√°ntos d√≥lares habr√≠a obtenido con el mismo dinero? c) Expliquen la diferencia en t√©rminos de porcentaje de ahorro o p√©rdida."
            },
            {
                id: "P3-INT-10",
                title: "Preparaci√≥n de notas de examen",
                tag: "Porcentajes y organizaci√≥n del tiempo",
                description:
                    "Una estudiante organiza su tiempo de estudio para un examen de Pensamiento Matem√°tico I. Decide dedicar el 40% del tiempo a razones y proporciones, el 35% a porcentajes y el resto a problemas integradores.",
                context:
                    "a) Si planea estudiar 15 horas en total, ¬øcu√°ntas horas dedicar√° a cada tema? b) Determinen qu√© porcentaje del tiempo representa la parte de problemas integradores. c) Expliquen por qu√© es importante distribuir el tiempo de manera proporcional seg√∫n la dificultad de los temas."
            }
        ];

        // ---------------------------------------------------------------------
        // MANEJO DE ESTADO Y LOCALSTORAGE
        // ---------------------------------------------------------------------

        const defaultState = {
            exerciseId: null,
            answer: "",
            attempts: 0,
            finalAnswer: "",
            lastUpdated: null
        };

        function loadState() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return { ...defaultState };
                const parsed = JSON.parse(raw);
                return { ...defaultState, ...parsed };
            } catch (err) {
                console.error("Error al leer estado:", err);
                return { ...defaultState };
            }
        }

        function saveState(state) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            } catch (err) {
                console.error("Error al guardar estado:", err);
            }
        }

        function clearState() {
            try {
                localStorage.removeItem(STORAGE_KEY);
            } catch (err) {
                console.error("Error al limpiar estado:", err);
            }
        }

        let appState = loadState();

        // ---------------------------------------------------------------------
        // FUNCIONES AUXILIARES
        // ---------------------------------------------------------------------

        function getRandomExerciseId() {
            if (!exercises.length) return null;
            const randomIndex = Math.floor(Math.random() * exercises.length);
            return exercises[randomIndex].id;
        }

        function getExerciseById(id) {
            return exercises.find(e => e.id === id) || null;
        }

        function formatDate(date) {
            const d = date.getDate().toString().padStart(2, "0");
            const m = (date.getMonth() + 1).toString().padStart(2, "0");
            const y = date.getFullYear();
            return `${d}/${m}/${y}`;
        }

        function formatTime(date) {
            const h = date.getHours().toString().padStart(2, "0");
            const m = date.getMinutes().toString().padStart(2, "0");
            return `${h}:${m} h`;
        }

        function buildMembersList() {
            const names = [
                integrante1Input.value.trim(),
                integrante2Input.value.trim(),
                integrante3Input.value.trim(),
                integrante4Input.value.trim()
            ].filter(Boolean);

            if (!names.length) return "Sin registros";
            if (names.length === 1) return names[0];

            const last = names.pop();
            return `${names.join(", ")} y ${last}`;
        }

        function updateExerciseUI() {
            let exerciseId = appState.exerciseId;
            if (!exerciseId) {
                exerciseId = getRandomExerciseId();
                appState.exerciseId = exerciseId;
                saveState(appState);
            }

            const exercise = getExerciseById(exerciseId);
            if (!exercise) {
                exerciseTitleEl.textContent = "No se encontr√≥ un ejercicio";
                exerciseDescriptionEl.textContent = "Ocurri√≥ un problema al cargar la actividad. Avise a su docente.";
                exerciseContextEl.textContent = "";
                return;
            }

            exerciseTitleEl.textContent = exercise.title;
            exerciseTagEl.textContent = exercise.tag;
            exerciseDescriptionEl.textContent = exercise.description;
            exerciseContextEl.textContent = exercise.context;

            if (appState.finalAnswer) {
                respuestaInput.value = appState.finalAnswer;
                feedbackEl.textContent = "Respuesta final registrada. Si necesitan corregirla, consulten a su docente.";
                feedbackEl.className = "feedback correct";
            } else {
                respuestaInput.value = appState.answer || "";
                feedbackEl.textContent = "";
                feedbackEl.className = "feedback";
            }

            updateSummaryUI();
        }

        function updateSummaryUI() {
            const attempts = appState.attempts || 0;
            const hasFinalAnswer = Boolean(appState.finalAnswer);

            attemptsCountEl.textContent = attempts.toString();
            scoreResultEl.textContent = hasFinalAnswer ? appState.finalAnswer || "‚Äì" : "‚Äì";

            let progress = 0;
            if (attempts > 0) progress = 50;
            if (hasFinalAnswer) progress = 100;
            progressPercentEl.textContent = `${progress}%`;

            if (!attempts) {
                summaryTextEl.textContent =
                    "Cuando registren su respuesta, aqu√≠ aparecer√° un resumen con los intentos y el resultado final.";
                attemptWarningEl.textContent = "";
                return;
            }

            if (attempts === 1 && hasFinalAnswer) {
                summaryTextEl.textContent =
                    "Excelente, registraron su respuesta en el primer intento. Revisen el reporte y tomen captura de pantalla.";
                attemptWarningEl.textContent = "";
            } else if (attempts === 1 && !hasFinalAnswer) {
                summaryTextEl.textContent =
                    "Llevan un intento registrado. Si todav√≠a est√°n revisando procedimientos, pueden ajustar su respuesta antes de guardarla como final.";
                attemptWarningEl.textContent = "";
            } else if (attempts === 2 && !hasFinalAnswer) {
                summaryTextEl.textContent =
                    "Tienen dos intentos registrados. Es importante que en el siguiente intento definan ya su respuesta final.";
                attemptWarningEl.textContent =
                    "Atenci√≥n: el siguiente intento podr√≠a considerarse su respuesta final para la evidencia.";
            } else if (attempts >= 2 && hasFinalAnswer) {
                summaryTextEl.textContent =
                    "Registraron su respuesta final despu√©s de varios intentos. Revisen que los datos est√©n correctos en el reporte.";
                attemptWarningEl.textContent =
                    "Nota: su docente podr√° observar el n√∫mero de intentos realizados.";
            } else if (attempts >= MAX_ATTEMPTS) {
                summaryTextEl.textContent =
                    "Se lleg√≥ al n√∫mero m√°ximo de intentos sugeridos. Si a√∫n tienen dudas, consulten a su docente.";
                attemptWarningEl.textContent =
                    "Recomendaci√≥n: ya no modifiquen m√°s la respuesta sin antes revisar con el docente.";
            } else {
                summaryTextEl.textContent =
                    "Llevan varios intentos registrados. Procuren llegar a una respuesta final clara y justificada.";
                attemptWarningEl.textContent = "";
            }
        }

        // ---------------------------------------------------------------------
        // MANEJO DE RESPUESTAS
        // ---------------------------------------------------------------------

        function handleNewExercise() {
            if (appState.finalAnswer) {
                alert("Ya hay una respuesta final registrada. Si necesitan cambiar de ejercicio, consulten a su docente.");
                return;
            }

            const confirmed = confirm(
                "¬øSeguro que quieren cambiar de ejercicio?\n\n" +
                "Se conservar√° el n√∫mero de intentos, pero se asignar√° una situaci√≥n diferente."
            );
            if (!confirmed) return;

            appState.exerciseId = getRandomExerciseId();
            appState.answer = "";
            saveState(appState);
            updateExerciseUI();
            respuestaInput.focus();
        }

        function handleSaveAnswer() {
            const answer = (respuestaInput.value || "").trim();

            if (!answer) {
                alert("Escriban primero el resultado final de su equipo antes de guardar.");
                respuestaInput.focus();
                return;
            }

            const equipo = equipoInput.value.trim();
            const grupo = grupoInput ? grupoInput.value.trim() : GROUP_NAME;
            const integrante1 = integrante1Input.value.trim();
            const integrante2 = integrante2Input.value.trim();

            if (!equipo || !integrante1 || !integrante2) {
                alert("Por favor, registren al menos: nombre del equipo, grupo e integrantes 1 y 2.");
                return;
            }

            const attempts = (appState.attempts || 0) + 1;
            appState.attempts = attempts;
            appState.answer = answer;
            appState.finalAnswer = answer;
            appState.lastUpdated = new Date().toISOString();
            saveState(appState);

            feedbackEl.textContent = "Respuesta final guardada correctamente. Ahora pueden generar el reporte.";
            feedbackEl.className = "feedback correct";

            updateSummaryUI();
            updateReport();
        }

        function handleShowExample() {
            alert(
                "Ejemplo de c√≥mo resolver un problema integral:\n\n" +
                "1. Leer con atenci√≥n el contexto y subrayar los datos num√©ricos.\n" +
                "2. Identificar qu√© se est√° pidiendo (descuento, porcentaje, raz√≥n, etc.).\n" +
                "3. Organizar la informaci√≥n en una tabla o esquema.\n" +
                "4. Plantear operaciones paso a paso usando razones, proporciones o porcentajes.\n" +
                "5. Verificar que las unidades y el resultado final tengan sentido en el contexto.\n\n" +
                "En su cuaderno, expliquen con sus propias palabras c√≥mo llegaron al resultado."
            );
        }

        // ---------------------------------------------------------------------
        // REPORTE
        // ---------------------------------------------------------------------

        function updateReport() {
            const now = appState.lastUpdated ? new Date(appState.lastUpdated) : new Date();

            reportDateEl.textContent = formatDate(now);
            reportTimeEl.textContent = formatTime(now);

            const equipo = equipoInput.value.trim() || "Sin nombre";
            const grupo = (grupoInput ? grupoInput.value.trim() : GROUP_NAME) || GROUP_NAME;
            const turno = turnoInput.value.trim() || "Sin registro";

            resultTeamEl.textContent = equipo;
            resultMembersEl.textContent = buildMembersList();
            resultGroupEl.textContent = grupo;
            resultShiftEl.textContent = turno;

            const exercise = getExerciseById(appState.exerciseId);
            resultExerciseEl.textContent = exercise
                ? `${exercise.id} ‚Äì ${exercise.title}`
                : "Sin ejercicio asignado";

            const attempts = appState.attempts || 0;
            const finalAnswer = appState.finalAnswer || "Sin respuesta final";

            resultAnswerEl.textContent = finalAnswer;
            resultAttemptsEl.textContent = attempts.toString();

            if (!attempts) {
                resultSummaryMainEl.textContent = "Actividad en proceso";
                resultSummaryDetailEl.textContent =
                    "Todav√≠a no hay intentos registrados. Cuando guarden su respuesta, aqu√≠ aparecer√° el resumen.";
            } else if (attempts === 1) {
                resultSummaryMainEl.textContent = "Respuesta registrada en el primer intento";
                resultSummaryDetailEl.textContent =
                    "Buen trabajo. Revisen que sus procedimientos coincidan con el resultado final.";
            } else if (attempts === 2) {
                resultSummaryMainEl.textContent = "Respuesta final despu√©s de dos intentos";
                resultSummaryDetailEl.textContent =
                    "Recuerden comentar en clase qu√© ajustaron entre el primer y el segundo intento.";
            } else if (attempts >= 3) {
                resultSummaryMainEl.textContent = "Respuesta final despu√©s de varios intentos";
                resultSummaryDetailEl.textContent =
                    "Reflexionen qu√© dificultades encontraron y c√≥mo las resolvieron en equipo.";
            }
        }

        function handleGenerateReport() {
            if (!appState.finalAnswer) {
                const proceed = confirm(
                    "A√∫n no han guardado una respuesta final.\n\n" +
                    "El reporte se generar√° con la informaci√≥n disponible hasta ahora. " +
                    "¬øDesean continuar?"
                );
                if (!proceed) return;
            }

            updateReport();

            alert(
                "El reporte se actualiz√≥.\n\n" +
                "Ahora tomen una captura de pantalla donde se vea COMPLETO el recuadro del reporte:\n" +
                "‚Ä¢ Nombre del equipo, integrantes, grupo y turno\n" +
                "‚Ä¢ Ejercicio asignado y resultado final\n" +
                "‚Ä¢ N√∫mero de intentos, fecha y hora"
            );
        }

        function handleClearData() {
            const confirmed = confirm(
                "Esta acci√≥n eliminar√° los datos guardados en esta computadora (respuesta y n√∫mero de intentos).\n\n" +
                "¬øSeguro que desean limpiar la informaci√≥n?\n\n" +
                "Nota: esto no borra la evidencia que ya haya registrado su docente."
            );
            if (!confirmed) return;

            clearState();
            appState = { ...defaultState };
            respuestaInput.value = "";
            feedbackEl.textContent = "";
            feedbackEl.className = "feedback";
            updateExerciseUI();
            updateReport();
        }

        // ---------------------------------------------------------------------
        // INICIALIZACI√ìN
        // ---------------------------------------------------------------------

        function init() {
            if (!appState.exerciseId) {
                appState.exerciseId = getRandomExerciseId();
                saveState(appState);
            }

            updateExerciseUI();
            updateReport();

            btnNewExercise.addEventListener("click", handleNewExercise);
            btnSaveAnswer.addEventListener("click", handleSaveAnswer);
            btnShowExample.addEventListener("click", handleShowExample);
            btnGenerateReport.addEventListener("click", handleGenerateReport);
            btnClearData.addEventListener("click", handleClearData);

            respuestaInput.addEventListener("keydown", (event) => {
                if (event.key === "Enter" && !event.shiftKey) {
                    event.preventDefault();
                    handleSaveAnswer();
                }
            });
        }

        init();

        // ------------------------ CONTROL DE ACCESO POR CONTRASE√ëA ------------------------
        (function setupPasswordGate() {
            const overlay = document.getElementById("password-overlay");
            const passwordInput = document.getElementById("access-password");
            const accessButton = document.getElementById("access-button");
            const errorEl = document.getElementById("password-error");

            if (!overlay || !passwordInput || !accessButton) return;

            function tryAccess() {
                const entered = passwordInput.value.trim();
                if (entered === GROUP_PASSWORD) {
                    overlay.style.display = "none";
                    passwordInput.value = "";
                    if (errorEl) errorEl.textContent = "";
                    if (integrante1Input) {
                        integrante1Input.focus();
                    }
                } else {
                    if (errorEl) {
                        errorEl.textContent = "Contrase√±a incorrecta. Vuelve a intentarlo.";
                    }
                    passwordInput.select();
                }
            }

            accessButton.addEventListener("click", tryAccess);

            passwordInput.addEventListener("keydown", (event) => {
                if (event.key === "Enter") {
                    event.preventDefault();
                    tryAccess();
                }
            });

            passwordInput.focus();
        })();
    })();
</script>

</body>
</html>
